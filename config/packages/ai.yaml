ai:
    platform:
        openai:
            api_key: '%env(OPENAI_API_KEY)%'       # kept for Speech STT/TTS only
        huggingface:
            api_key: '%env(HUGGINGFACE_API_KEY)%'
    agent:
        blog:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-sonnet'
            tools:
                - 'Symfony\AI\Agent\Bridge\SimilaritySearch\SimilaritySearch'
                - service: 'clock'
                  name: 'clock'
                  description: 'Provides the current date and time.'
                  method: 'now'
            memory:
                service: 'App\Blog\SymfonyVersionsMemory'
        stream:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-haiku'
            prompt:
                file: '%kernel.project_dir%/prompts/stream-chat.txt'
            tools: false
        youtube:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-sonnet'
            tools: false
        recipe:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-sonnet'
            prompt:
                text: 'You are a helpful cooking assistant. Provide detailed recipes based on user requests.'
            tools: false
        wikipedia:
            platform: 'ai.platform.amazeeai'
            model:
                name: 'claude-3-5-sonnet'
                options:
                    temperature: 0.5
            prompt:
                text: 'Please answer the users question based on Wikipedia, only use information provided in the messages.'
                include_tools: true
            tools:
                - 'Symfony\AI\Agent\Bridge\Wikipedia\Wikipedia'
            include_sources: true
        speech:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-sonnet?temperature=1.0'
            prompt: |
                You are a friendly, positive and energetic voice assistant. You can engage in light discussions, ask
                questions, and do general small-talk. If asked about the Symfony Framework or their community events,
                you delegate to your subagent "symfony_blog" and use their answer for answering user's questions.
                If you don't know the answer, say so. Keep in mind that you are in a spoken conversation, so keep your
                answers concise and to the point. They will be read out loud to the user.
            tools:
                - 'Symfony\AI\Agent\Bridge\Clock\Clock'
                # Agent in agent ðŸ¤¯
                - agent: 'blog'
                  name: 'symfony_blog'
                  description: |
                      Subagent, that can answer questions about latest news around the Symfony Framework, like latest
                      features, events or community news.
        # Multi-agent setup
        orchestrator:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-haiku'
            prompt: 'You are an intelligent agent orchestrator that routes user questions to specialized agents.'
            tools: false
        technical:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-sonnet'
            prompt: 'You are a technical support specialist. Help users resolve bugs, problems, and technical errors.'
            tools: false
        fallback:
            platform: 'ai.platform.amazeeai'
            model: 'claude-3-5-haiku'
            prompt: 'You are a helpful general assistant. Assist users with any questions or tasks they may have.'
            tools: false
    multi_agent:
        support:
            orchestrator: 'orchestrator'
            handoffs:
                technical: ['bug', 'problem', 'technical', 'error', 'code', 'debug']
            fallback: 'fallback'
    store:
        postgres:
            symfonycon:
                dsn: '%env(AMAZEEAI_VDB_DSN)%'
                username: '%env(AMAZEEAI_VDB_USER)%'
                password: '%env(AMAZEEAI_VDB_PASSWORD)%'
                table_name: 'symfony_blog'
                vector_field: 'embedding'
                distance: 'cosine'
    vectorizer:
        amazeeai:
            platform: 'ai.platform.amazeeai'
            model: 'titan-embed-text-v2:0'
    indexer:
        blog:
            loader: 'Symfony\AI\Store\Document\Loader\RssFeedLoader'
            source: 'https://feeds.feedburner.com/symfony/blog'
            filters:
                - 'app.filter.week_of_symfony'
            transformers:
                - 'Symfony\AI\Store\Document\Transformer\TextSplitTransformer'
                - 'Symfony\AI\Store\Document\Transformer\TextTrimTransformer'
            vectorizer: 'ai.vectorizer.amazeeai'
            store: 'ai.store.postgres.symfonycon'
    retriever:
        blog:
            vectorizer: 'ai.vectorizer.amazeeai'
            store: 'ai.store.postgres.symfonycon'

services:
    _defaults:
        autowire: true
        autoconfigure: true

    app.amazeeai_model_catalog:
        class: 'Symfony\AI\Platform\Bridge\AmazeeAi\ModelApiCatalog'
        arguments:
            $httpClient: '@http_client'
            $baseUrl: '%env(AMAZEEAI_LLM_API_URL)%'
            $apiKey: '%env(AMAZEEAI_LLM_KEY)%'

    ai.platform.amazeeai:
        class: 'Symfony\AI\Platform\Platform'
        factory: ['Symfony\AI\Platform\Bridge\AmazeeAi\PlatformFactory', 'create']
        arguments:
            $baseUrl: '%env(AMAZEEAI_LLM_API_URL)%'
            $apiKey: '%env(AMAZEEAI_LLM_KEY)%'
            $httpClient: '@http_client'
            $modelCatalog: '@app.amazeeai_model_catalog'

    Symfony\AI\Agent\Bridge\SimilaritySearch\SimilaritySearch:
        $vectorizer: '@ai.vectorizer.amazeeai'
        $store: '@ai.store.postgres.symfonycon'

    Symfony\AI\Store\Document\Loader\RssFeedLoader: ~
    Symfony\AI\Store\Document\Transformer\TextSplitTransformer: ~
    Symfony\AI\Store\Document\Transformer\TextTrimTransformer: ~

    app.filter.week_of_symfony:
        class: 'Symfony\AI\Store\Document\Filter\TextContainsFilter'
        arguments:
            $needle: 'Week of Symfony'
            $caseSensitive: false
